L.Polyline.Measure=L.Draw.Polyline.extend({addHooks:function(){L.Draw.Polyline.prototype.addHooks.call(this),this._map&&(this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._markers=[],this._map.on("click",this._onClick,this),this._startShape())},removeHooks:function(){L.Draw.Polyline.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this).off("click",this._onClick,this),this._clearGuides(),this._container.style.cursor="",this._removeShape()},_startShape:function(){this._drawing=!0,this._poly=new L.Polyline([],this.options.shapeOptions),this._poly._onClick=function(){},this._container.style.cursor="crosshair",this._updateTooltip(),this._map.on("pointermove",this._onMouseMove,this).on("mousemove",this._onMouseMove,this)},_finishShape:function(){this._drawing=!1,this._cleanUpShape(),this._clearGuides(),this._updateTooltip(),this._map.off("pointermove",this._onMouseMove,this).off("mousemove",this._onMouseMove,this),this._container.style.cursor=""},_removeShape:function(){this._poly&&(this._map.removeLayer(this._poly),delete this._poly,this._markers.splice(0),this._markerGroup.clearLayers())},_onClick:function(e){if(!this._drawing)return this._removeShape(),void this._startShape()},_getTooltipText:function(){var e=L.Draw.Polyline.prototype._getTooltipText.call(this)
return this._drawing||(e.text=""),e}}),L.Control.MeasureControl=L.Control.extend({statics:{TITLE:"Measure distances"},options:{position:"topleft",handler:{}},toggle:function(){this.handler.enabled()?this.handler.disable.call(this.handler):this.handler.enable.call(this.handler)},onAdd:function(e){var t="leaflet-control-draw"
this._container=L.DomUtil.create("div","leaflet-bar"),this.handler=new L.Polyline.Measure(e,this.options.handler),this.handler.on("enabled",function(){this.enabled=!0,L.DomUtil.addClass(this._container,"enabled")},this),this.handler.on("disabled",function(){delete this.enabled,L.DomUtil.removeClass(this._container,"enabled")},this)
var o=L.DomUtil.create("a",t+"-measure",this._container)
return o.href="#",o.title=L.Control.MeasureControl.TITLE,L.DomEvent.addListener(o,"click",L.DomEvent.stopPropagation).addListener(o,"click",L.DomEvent.preventDefault).addListener(o,"click",this.toggle,this),this._container}}),L.Map.mergeOptions({measureControl:!1}),L.Map.addInitHook(function(){this.options.measureControl&&(this.measureControl=L.Control.measureControl().addTo(this))}),L.Control.measureControl=function(e){return new L.Control.MeasureControl(e)}
